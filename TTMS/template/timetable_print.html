<!DOCTYPE html>
<html>
<head>
    <title>Official College Timetable</title>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Times New Roman", serif;
            margin: 10px;
            padding: 10px;
            font-size: 11px;
        }

        h2 {
            text-align: center;
            margin: 2px 0;
            font-size: 13px;
        }

        h3 {
            text-align: center;
            margin: 1px 0;
            font-size: 12px;
        }

        h4 {
            text-align: center;
            margin: 1px 0;
            font-size: 11px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
            margin: 2px 0;
        }

        /* Main timetable */
        table:nth-of-type(2) {
            margin-bottom: 3px;
        }

        /* Legend table */
        table:nth-of-type(3) {
            font-size: 9px;
        }

        /* Signatures table */
        table:nth-of-type(4) {
            margin-top: 2px;
        }

        th, td {
            border: 1px solid black;
            padding: 2px 1px;
            text-align: center;
            vertical-align: middle;
        }

        /* Legend cells smaller */
        table:nth-of-type(3) th,
        table:nth-of-type(3) td {
            padding: 1px;
            font-size: 8px;
        }

        th {
            font-weight: bold;
        }

        .no-border {
            border: none;
        }

        .lunch {
            font-weight: bold;
            background: #f0f0f0;
            padding: 2px;
        }

        .left {
            text-align: left;
        }

        .right {
            text-align: right;
        }

        .signature {
            height: 30px;
            font-size: 9px;
        }

        br {
            line-height: 0.5;
        }

        small {
            font-size: 9px;
            line-height: 1.2;
        }

        @media print {
            button {
                display: none;
            }
            body {
                margin: 5px;
                padding: 5px;
            }
        }
    </style>
</head>

<body>

<button onclick="window.print()">Print</button>

<!-- HEADER -->
<h2>K.S.K COLLEGE OF ENGINEERING & TECHNOLOGY</h2>
<h3>DEPARTMENT OF {{ course }}</h3>
<h4>ACADEMIC YEAR 2025â€“2026</h4>
<h3>TIMETABLE</h3>
<br>

<table class="no-border">
    <tr>
        <td class="no-border left"><b>Year:</b> {{ year }}</td>
        <td class="no-border right"><b>Semester:</b> {{ semester or 'VI' }}</td>
    </tr>
</table>

<br>

<!-- MAIN TIMETABLE -->
<table>
    <tr>
        <th>Day / Period</th>
        <th>9:30 - 10:20</th>
        <th>10:20 - 11:10</th>
        <th>11:10 - 12:10</th>
        <th>12:10 - 1:00</th>
        <th rowspan="6" class="lunch">L<br>U<br>N<br>C<br>H</th>
        <th>1:45 - 2:35</th>
        <th>2:35 - 3:20</th>
        <th>3:30 - 4:20</th>
    </tr>

    {% for day, periods in timetable.items() %}
    <tr>
        <th>{{ day }}</th>
        <td>{{ periods[0]|safe }}</td>
        <td>{{ periods[1]|safe }}</td>
        <td>{{ periods[2]|safe }}</td>
        <td>{{ periods[3]|safe }}</td>
        <td>{{ periods[4]|safe }}</td>
        <td>{{ periods[5]|safe }}</td>
        <td>{{ periods[6]|safe }}</td>
    </tr>
    {% endfor %}
</table>

<br><br>

<!-- SUBJECT LEGEND -->
<table style="margin-top: 1px;">
    <tr>
        <th>Subject Code</th>
        <th>Subject Name</th>
        <th>Staff Name</th>
    </tr>

    {% set seen_subjects = [] %}
    {% for day, periods in timetable.items() %}
        {% for cell in periods %}
            {% if cell %}
                {% set parts = cell.split('<br>') %}
                {% set code = parts[0]|safe %}
                {% set name = (parts[1] if parts|length > 1 else '')|safe %}
                {% set staff = (parts[2] if parts|length > 2 else '')|safe %}
                {% set subject_key = code ~ '|' ~ staff %}
                {% if subject_key not in seen_subjects %}
                    {% set _ = seen_subjects.append(subject_key) %}
                    <tr>
                        <td>{{ code }}</td>
                        <td>{{ name }}</td>
                        <td>{{ staff }}</td>
                    </tr>
                {% endif %}
            {% endif %}
        {% endfor %}
    {% endfor %}
</table>

<br><br>

<!-- SIGNATURES -->
<table class="no-border">
    <tr>
        <td class="no-border left signature">
            <b>Time Table Coordinator</b>
        </td>
        <td class="no-border left signature">
            <b>HOD</b>
        </td>
        <td class="no-border left signature">
            <b>Principal</b>
        </td>
    </tr>
</table>

<script>
function loadTimetable() {
    const year = document.getElementById("yearFilter").value;

    fetch(`/get_timetable?year=${year}`)
        .then(res => res.json())
        .then(data => {
            const body = document.getElementById("timetableBody");
            body.innerHTML = "";

            data.forEach(row => {
                body.innerHTML += `
                <tr>
                    <td>${row.day}</td>
                    <td>${row.p1 || ''}</td>
                    <td>${row.p2 || ''}</td>
                    <td>${row.p3 || ''}</td>
                    <td>${row.p4 || ''}</td>
                    <td>${row.p5 || ''}</td>
                    <td>${row.p6 || ''}</td>
                </tr>`;
            });
        });
}

window.onload = loadTimetable;
</script>

</body>
</html>