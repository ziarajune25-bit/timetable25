{% extends "base.html" %}
{% block title %}View Timetable{% endblock %}

{% block content %}
<div class="timetable-header">
    <h3 style="margin: 5px 0; font-size: 18px;">Timetable Schedule</h3>
    
    <div style="display: flex; justify-content: space-between; margin-top: 15px; font-weight: bold;">
        <span>Year: {{ year }}</span>
        <span>Course ID: {{ course_id }}</span>
        <span>Semester: {{ semester }}</span>
    </div>
</div>

<div class="timetable-container">
    {% if timetable and timetable.values()|list|first %}
    <table class="timetable">
        <tr>
            <th>Day</th>
            <th>P1</th><th>P2</th><th>P3</th>
            <th>P4</th><th>LUNCH</th><th>P5</th><th>P6</th><th>P7</th>
        </tr>

        {% for day, periods in timetable.items() %}
        <tr>
            <td class="day-cell"><strong>{{ day }}</strong></td>
            <td>{{ periods[0]|safe }}</td>
            <td>{{ periods[1]|safe }}</td>
            <td>{{ periods[2]|safe }}</td>
            <td>{{ periods[3]|safe }}</td>
            <td class="lunch-cell" style="background: #f0f0f0;"><strong>LUNCH</strong></td>
            <td>{{ periods[4]|safe }}</td>
            <td>{{ periods[5]|safe }}</td>
            <td>{{ periods[6]|safe }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <div style="text-align: center; padding: 30px; color: #666;">
        <p><strong>No timetable generated yet for Year {{ year }}, Course {{ course_id }}</strong></p>
        <p>Please ask the admin to generate a timetable first.</p>
    </div>
    {% endif %}
</div>

<br>

<!-- MASTER TIMETABLE SECTION - ADMIN ONLY -->
{% if session.get('role') == 'admin' %}
<div class="master-timetable-section" style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #ddd;">
    <h2>Master Timetable</h2>

    <!-- YEAR FILTER -->
    <select id="yearFilter" onchange="loadTimetable()">
        <option value="all">All</option>
        <option value="1">1st Year</option>
        <option value="2">2nd Year</option>
        <option value="3">3rd Year</option>
        <option value="4">4th Year</option>
    </select>

    <br><br>

    <!-- TIMETABLE TABLE -->
    <table border="1" width="100%">
        <thead>
            <tr>
                <th>Day</th>
                <th>9:30–10:20</th>
                <th>10:20–11:10</th>
                <th>11:20–12:10</th>
                <th>12:10–1:00</th>
                <th>2:35–3:25</th>
                <th>3:25–4:20</th>
            </tr>
        </thead>
        <tbody id="timetableBody">
            <!-- Data comes here -->
        </tbody>
    </table>
</div>
{% endif %}

<br>
<div style="text-align: center;">
    <a class="btn" href="/print?year={{ year }}&course_id={{ course_id }}&semester={{ semester }}" target="_blank">Print Timetable</a>
</div>
{% endblock %}